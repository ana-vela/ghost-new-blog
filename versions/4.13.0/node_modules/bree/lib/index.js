"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _typeof2 = _interopRequireDefault(require("@babel/runtime/helpers/typeof"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

function _createForOfIteratorHelper(o, allowArrayLike) { var it; if (typeof Symbol === "undefined" || o[Symbol.iterator] == null) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = o[Symbol.iterator](); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it.return != null) it.return(); } finally { if (didErr) throw err; } } }; }

function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }

function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = (0, _getPrototypeOf2.default)(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = (0, _getPrototypeOf2.default)(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return (0, _possibleConstructorReturn2.default)(this, result); }; }

function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }

var EventEmitter = require('events');

var fs = require('fs');

var _require = require('path'),
    resolve = _require.resolve;

var pWaitFor = require('p-wait-for');

var combineErrors = require('combine-errors');

var debug = require('debug')('bree');

var isSANB = require('is-string-and-not-blank');

var isValidPath = require('is-valid-path');

var later = require('@breejs/later');

var threads = require('bthreads');

var _require2 = require('safe-timers'),
    setTimeout = _require2.setTimeout,
    setInterval = _require2.setInterval;

var _require3 = require('./job-utils'),
    isSchedule = _require3.isSchedule,
    getName = _require3.getName,
    getHumanToMs = _require3.getHumanToMs,
    parseValue = _require3.parseValue,
    getJobNames = _require3.getJobNames;

var buildJob = require('./job-builder');

var validateJob = require('./job-validator'); // Bthreads requires us to do this for web workers (see bthreads docs for insight)


threads.Buffer = Buffer; // Instead of `threads.browser` checks below, we previously used this boolean
// const hasFsStatSync = typeof fs === 'object' && typeof fs.statSync === 'function';

var Bree = /*#__PURE__*/function (_EventEmitter) {
  (0, _inherits2.default)(Bree, _EventEmitter);

  var _super = _createSuper(Bree);

  function Bree(config) {
    var _this;

    (0, _classCallCheck2.default)(this, Bree);
    _this = _super.call(this);
    _this.config = _objectSpread({
      // We recommend using Cabin for logging
      // <https://cabinjs.com>
      logger: console,
      // Set this to `false` to prevent requiring a root directory of jobs
      // (e.g. if your jobs are not all in one directory)
      root: threads.browser
      /* istanbul ignore next */
      ? threads.resolve('jobs') : resolve('jobs'),
      // Default timeout for jobs
      // (set this to `false` if you do not wish for a default timeout to be set)
      timeout: 0,
      // Default interval for jobs
      // (set this to `0` for no interval, and > 0 for a default interval to be set)
      interval: 0,
      // This is an Array of your job definitions (see README for examples)
      jobs: [],
      // <https://breejs.github.io/later/parsers.html#cron>
      // (can be overridden on a job basis with same prop name)
      hasSeconds: false,
      // <https://github.com/Airfooox/cron-validate>
      cronValidate: {},
      // If you set a value > 0 here, then it will terminate workers after this time (ms)
      closeWorkerAfterMs: 0,
      // Could also be mjs if desired
      // (this is the default extension if you just specify a job's name without ".js" or ".mjs")
      defaultExtension: 'js',
      // Default worker options to pass to ~`new Worker`~ `new threads.Worker`
      // (can be overridden on a per job basis)
      // <https://nodejs.org/api/worker_threads.html#worker_threads_new_worker_filename_options>
      worker: {},
      // Custom handler to execute when error events are emitted by the workers or when they exit
      // with non-zero code
      // pass in a callback function with following signature: `(error, workerMetadata) => { // custom handling here }`
      errorHandler: null,
      // Custom handler executed when a `message` event is received from a worker.
      // A special 'done' even is also broadcasted while leaving worker shutdown logic in place.
      workerMessageHandler: null,
      //
      // if you set this to `true`, then a second arg is passed to log output
      // and it will be an Object with `{ worker: Object }` set, for example:
      // (see the documentation at <https://nodejs.org/api/worker_threads.html> for more insight)
      //
      // logger.info('...', {
      //   worker: {
      //     isMainThread: Boolean
      //     resourceLimits: Object,
      //     threadId: String
      //   }
      // });
      //
      outputWorkerMetadata: false
    }, config); //
    // if `hasSeconds` is `true` then ensure that
    // `cronValidate` object has `override` object with `useSeconds` set to `true`
    // <https://github.com/breejs/bree/issues/7>
    //

    if (_this.config.hasSeconds) {
      _this.config.cronValidate = _objectSpread(_objectSpread({}, _this.config.cronValidate), {}, {
        preset: _this.config.cronValidate && _this.config.cronValidate.preset ? _this.config.cronValidate.preset : 'default',
        override: _objectSpread(_objectSpread({}, _this.config.cronValidate && _this.config.cronValidate.override ? _this.config.cronValidate.override : {}), {}, {
          useSeconds: true
        })
      });
    }

    debug('config', _this.config);
    _this.closeWorkerAfterMs = {};
    _this.workers = {};
    _this.timeouts = {};
    _this.intervals = {};
    _this.isSchedule = isSchedule;
    _this.getWorkerMetadata = _this.getWorkerMetadata.bind((0, _assertThisInitialized2.default)(_this));
    _this.run = _this.run.bind((0, _assertThisInitialized2.default)(_this));
    _this.start = _this.start.bind((0, _assertThisInitialized2.default)(_this));
    _this.stop = _this.stop.bind((0, _assertThisInitialized2.default)(_this));
    _this.add = _this.add.bind((0, _assertThisInitialized2.default)(_this));
    _this.remove = _this.remove.bind((0, _assertThisInitialized2.default)(_this));
    _this.validateJob = validateJob;
    _this.getName = getName;
    _this.getHumanToMs = getHumanToMs;
    _this.parseValue = parseValue; // so plugins can extend constructor

    _this.init = _this.init.bind((0, _assertThisInitialized2.default)(_this));

    _this.init();

    debug('this.config.jobs', _this.config.jobs);
    return _this;
  }

  (0, _createClass2.default)(Bree, [{
    key: "init",
    value: function init() {
      // Validate root (sync check)
      if (isSANB(this.config.root)) {
        /* istanbul ignore next */
        if (!threads.browser && isValidPath(this.config.root)) {
          var stats = fs.statSync(this.config.root);

          if (!stats.isDirectory()) {
            throw new Error("Root directory of ".concat(this.config.root, " does not exist"));
          }
        }
      } // Validate timeout


      this.config.timeout = this.parseValue(this.config.timeout);
      debug('timeout', this.config.timeout); // Validate interval

      this.config.interval = this.parseValue(this.config.interval);
      debug('interval', this.config.interval); //
      // if `this.config.jobs` is an empty array
      // then we should try to load `jobs/index.js`
      //

      if (this.config.root && (!Array.isArray(this.config.jobs) || this.config.jobs.length === 0)) {
        try {
          this.config.jobs = threads.require(this.config.root);
        } catch (err) {
          this.config.logger.error(err);
        }
      } //
      // validate jobs
      //


      if (!Array.isArray(this.config.jobs)) {
        throw new TypeError('Jobs must be an Array');
      } // Provide human-friendly errors for complex configurations


      var errors = [];
      /*
      Jobs = [
        'name',
        { name: 'boot' },
        { name: 'timeout', timeout: ms('3s') },
        { name: 'cron', cron: '* * * * *' },
        { name: 'cron with timeout', timeout: '3s', cron: '* * * * *' },
        { name: 'interval', interval: ms('4s') }
        { name: 'interval', path: '/some/path/to/script.js', interval: ms('4s') },
        { name: 'timeout', timeout: 'three minutes' },
        { name: 'interval', interval: 'one minute' },
        { name: 'timeout', timeout: '3s' },
        { name: 'interval', interval: '30d' },
        { name: 'schedule object', interval: { schedules: [] } }
      ]
      */

      for (var i = 0; i < this.config.jobs.length; i++) {
        try {
          var names = getJobNames(this.config.jobs, i);
          validateJob(this.config.jobs[i], i, names, this.config);
          this.config.jobs[i] = buildJob(this.config.jobs[i], this.config);
        } catch (err) {
          errors.push(err);
        }
      } // If there were any errors then throw them


      if (errors.length > 0) {
        throw combineErrors(errors);
      }
    }
  }, {
    key: "getWorkerMetadata",
    value: function getWorkerMetadata(name) {
      var meta = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
      var job = this.config.jobs.find(function (j) {
        return j.name === name;
      });

      if (!job) {
        throw new Error("Job \"".concat(name, "\" does not exist"));
      }

      if (!this.config.outputWorkerMetadata && !job.outputWorkerMetadata) {
        return meta && (typeof meta.err !== 'undefined' || typeof meta.message !== 'undefined') ? meta : undefined;
      }

      return this.workers[name] ? _objectSpread(_objectSpread({}, meta), {}, {
        worker: {
          isMainThread: this.workers[name].isMainThread,
          resourceLimits: this.workers[name].resourceLimits,
          threadId: this.workers[name].threadId
        }
      }) : meta;
    }
  }, {
    key: "run",
    value: function run(name) {
      var _this2 = this;

      debug('run', name);

      if (name) {
        var job = this.config.jobs.find(function (j) {
          return j.name === name;
        });

        if (!job) {
          throw new Error("Job \"".concat(name, "\" does not exist"));
        }

        if (this.workers[name]) {
          return this.config.logger.warn(new Error("Job \"".concat(name, "\" is already running")), this.getWorkerMetadata(name));
        }

        debug('starting worker', name);

        var object = _objectSpread(_objectSpread(_objectSpread({}, this.config.worker ? this.config.worker : {}), job.worker ? job.worker : {}), {}, {
          workerData: _objectSpread(_objectSpread({
            job: job
          }, this.config.worker && this.config.worker.workerData ? this.config.worker.workerData : {}), job.worker && job.worker.workerData ? job.worker.workerData : {})
        });

        this.workers[name] = new threads.Worker(job.path, object);
        this.emit('worker created', name);
        debug('worker started', name);
        var prefix = "Worker for job \"".concat(name, "\"");
        this.workers[name].on('online', function () {
          // If we specified a value for `closeWorkerAfterMs`
          // then we need to terminate it after that execution time
          var closeWorkerAfterMs = Number.isFinite(job.closeWorkerAfterMs) ? job.closeWorkerAfterMs : _this2.config.closeWorkerAfterMs;

          if (Number.isFinite(closeWorkerAfterMs) && closeWorkerAfterMs > 0) {
            debug('worker has close set', name, closeWorkerAfterMs);
            _this2.closeWorkerAfterMs[name] = setTimeout(function () {
              /* istanbul ignore else */
              if (_this2.workers[name]) {
                debug('worker has been terminated', name);

                _this2.workers[name].terminate();
              }
            }, closeWorkerAfterMs);
          }

          _this2.config.logger.info("".concat(prefix, " online"), _this2.getWorkerMetadata(name));
        });
        this.workers[name].on('message', function (message) {
          var metadata = _this2.getWorkerMetadata(name, {
            message: message
          });

          if (_this2.config.workerMessageHandler) {
            _this2.config.workerMessageHandler(_objectSpread({
              name: name
            }, metadata));
          } else if (message === 'done') {
            _this2.config.logger.info("".concat(prefix, " signaled completion"), metadata);
          } else {
            _this2.config.logger.info("".concat(prefix, " sent a message"), metadata);
          }

          if (message === 'done') {
            _this2.workers[name].removeAllListeners('message');

            _this2.workers[name].removeAllListeners('exit');

            _this2.workers[name].terminate();

            delete _this2.workers[name];
          }
        }); // NOTE: you cannot catch messageerror since it is a Node internal
        //       (if anyone has any idea how to catch this in tests let us know)

        /* istanbul ignore next */

        this.workers[name].on('messageerror', function (err) {
          if (_this2.config.errorHandler) {
            _this2.config.errorHandler(err, _objectSpread({
              name: name
            }, _this2.getWorkerMetadata(name, {
              err: err
            })));
          } else {
            _this2.config.logger.error("".concat(prefix, " had a message error"), _this2.getWorkerMetadata(name, {
              err: err
            }));
          }
        });
        this.workers[name].on('error', function (err) {
          if (_this2.config.errorHandler) {
            _this2.config.errorHandler(err, _objectSpread({
              name: name
            }, _this2.getWorkerMetadata(name, {
              err: err
            })));
          } else {
            _this2.config.logger.error("".concat(prefix, " had an error"), _this2.getWorkerMetadata(name, {
              err: err
            }));
          }
        });
        this.workers[name].on('exit', function (code) {
          var level = code === 0 ? 'info' : 'error';

          if (level === 'error' && _this2.config.errorHandler) {
            _this2.config.errorHandler(new Error("".concat(prefix, " exited with code ").concat(code)), _objectSpread({
              name: name
            }, _this2.getWorkerMetadata(name)));
          } else {
            _this2.config.logger[level]("".concat(prefix, " exited with code ").concat(code), _this2.getWorkerMetadata(name));
          }

          delete _this2.workers[name];

          _this2.emit('worker deleted', name);
        });
        return;
      }

      var _iterator = _createForOfIteratorHelper(this.config.jobs),
          _step;

      try {
        for (_iterator.s(); !(_step = _iterator.n()).done;) {
          var _job = _step.value;
          this.run(_job.name);
        }
      } catch (err) {
        _iterator.e(err);
      } finally {
        _iterator.f();
      }
    }
  }, {
    key: "start",
    value: function start(name) {
      var _this3 = this;

      debug('start', name);

      if (name) {
        var job = this.config.jobs.find(function (j) {
          return j.name === name;
        });

        if (!job) {
          throw new Error("Job ".concat(name, " does not exist"));
        }

        if (this.timeouts[name] || this.intervals[name] || this.workers[name]) {
          return this.config.logger.warn(new Error("Job \"".concat(name, "\" is already started")));
        }

        debug('job', job); // Check for date and if it is in the past then don't run it

        if (job.date instanceof Date) {
          debug('job date', job);

          if (job.date.getTime() < Date.now()) {
            debug('job date was in the past');
            return;
          }

          this.timeouts[name] = setTimeout(function () {
            _this3.run(name);

            if (_this3.isSchedule(job.interval)) {
              debug('job.interval is schedule', job);
              _this3.intervals[name] = later.setInterval(function () {
                return _this3.run(name);
              }, job.interval);
            } else if (Number.isFinite(job.interval) && job.interval > 0) {
              debug('job.interval is finite', job);
              _this3.intervals[name] = setInterval(function () {
                return _this3.run(name);
              }, job.interval);
            } else {
              debug('job.date was scheduled to run only once', job);
            }

            delete _this3.timeouts[name];
          }, job.date.getTime() - Date.now());
          return;
        } // This is only complex because both timeout and interval can be a schedule


        if (this.isSchedule(job.timeout)) {
          debug('job timeout is schedule', job);
          this.timeouts[name] = later.setTimeout(function () {
            _this3.run(name);

            if (_this3.isSchedule(job.interval)) {
              debug('job.interval is schedule', job);
              _this3.intervals[name] = later.setInterval(function () {
                return _this3.run(name);
              }, job.interval);
            } else if (Number.isFinite(job.interval) && job.interval > 0) {
              debug('job.interval is finite', job);
              _this3.intervals[name] = setInterval(function () {
                return _this3.run(name);
              }, job.interval);
            }

            delete _this3.timeouts[name];
          }, job.timeout);
          return;
        }

        if (Number.isFinite(job.timeout)) {
          debug('job timeout is finite', job);
          this.timeouts[name] = setTimeout(function () {
            _this3.run(name);

            if (_this3.isSchedule(job.interval)) {
              debug('job.interval is schedule', job);
              _this3.intervals[name] = later.setInterval(function () {
                return _this3.run(name);
              }, job.interval);
            } else if (Number.isFinite(job.interval) && job.interval > 0) {
              debug('job.interval is finite', job.interval);
              _this3.intervals[name] = setInterval(function () {
                return _this3.run(name);
              }, job.interval);
            }

            delete _this3.timeouts[name];
          }, job.timeout);
        } else if (this.isSchedule(job.interval)) {
          debug('job.interval is schedule', job);
          this.intervals[name] = later.setInterval(function () {
            return _this3.run(name);
          }, job.interval);
        } else if (Number.isFinite(job.interval) && job.interval > 0) {
          debug('job.interval is finite', job);
          this.intervals[name] = setInterval(function () {
            return _this3.run(name);
          }, job.interval);
        }

        return;
      }

      var _iterator2 = _createForOfIteratorHelper(this.config.jobs),
          _step2;

      try {
        for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {
          var _job2 = _step2.value;
          this.start(_job2.name);
        }
      } catch (err) {
        _iterator2.e(err);
      } finally {
        _iterator2.f();
      }
    }
  }, {
    key: "stop",
    value: function () {
      var _stop = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee(name) {
        var _this4 = this;

        var _iterator3, _step3, job;

        return _regenerator.default.wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                if (!name) {
                  _context.next = 6;
                  break;
                }

                if (this.timeouts[name]) {
                  if ((0, _typeof2.default)(this.timeouts[name]) === 'object' && typeof this.timeouts[name].clear === 'function') {
                    this.timeouts[name].clear();
                  }

                  delete this.timeouts[name];
                }

                if (this.intervals[name]) {
                  if ((0, _typeof2.default)(this.intervals[name]) === 'object' && typeof this.intervals[name].clear === 'function') {
                    this.intervals[name].clear();
                  }

                  delete this.intervals[name];
                }

                if (this.workers[name]) {
                  this.workers[name].once('message', function (message) {
                    if (message === 'cancelled') {
                      _this4.config.logger.info("Gracefully cancelled worker for job \"".concat(name, "\""), _this4.getWorkerMetadata(name));

                      _this4.workers[name].terminate();
                    }
                  });
                  this.workers[name].postMessage('cancel');
                }

                if (this.closeWorkerAfterMs[name]) {
                  if ((0, _typeof2.default)(this.closeWorkerAfterMs[name]) === 'object' && typeof this.closeWorkerAfterMs[name].clear === 'function') {
                    this.closeWorkerAfterMs[name].clear();
                  }

                  delete this.closeWorkerAfterMs[name];
                }

                return _context.abrupt("return", pWaitFor(function () {
                  return _this4.workers[name] === undefined;
                }));

              case 6:
                _iterator3 = _createForOfIteratorHelper(this.config.jobs);

                try {
                  for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {
                    job = _step3.value;
                    this.stop(job.name);
                  }
                } catch (err) {
                  _iterator3.e(err);
                } finally {
                  _iterator3.f();
                }

                return _context.abrupt("return", pWaitFor(function () {
                  return Object.keys(_this4.workers).length === 0;
                }));

              case 9:
              case "end":
                return _context.stop();
            }
          }
        }, _callee, this);
      }));

      function stop(_x) {
        return _stop.apply(this, arguments);
      }

      return stop;
    }()
  }, {
    key: "add",
    value: function add(jobs) {
      var _this$config$jobs;

      //
      // make sure jobs is an array
      //
      if (!Array.isArray(jobs)) {
        jobs = [jobs];
      }

      var errors = [];
      var addedJobs = [];

      var _iterator4 = _createForOfIteratorHelper(jobs.entries()),
          _step4;

      try {
        for (_iterator4.s(); !(_step4 = _iterator4.n()).done;) {
          var _step4$value = (0, _slicedToArray2.default)(_step4.value, 2),
              i = _step4$value[0],
              job_ = _step4$value[1];

          try {
            var names = [].concat((0, _toConsumableArray2.default)(getJobNames(jobs, i)), (0, _toConsumableArray2.default)(getJobNames(this.config.jobs)));
            validateJob(job_, i, names, this.config);
            var job = buildJob(job_, this.config);
            addedJobs.push(job);
          } catch (err) {
            errors.push(err);
          }
        }
      } catch (err) {
        _iterator4.e(err);
      } finally {
        _iterator4.f();
      }

      debug('jobs added', this.config.jobs); // If there were any errors then throw them

      if (errors.length > 0) {
        throw combineErrors(errors);
      }

      (_this$config$jobs = this.config.jobs).push.apply(_this$config$jobs, addedJobs);

      return addedJobs;
    }
  }, {
    key: "remove",
    value: function () {
      var _remove = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee2(name) {
        var job;
        return _regenerator.default.wrap(function _callee2$(_context2) {
          while (1) {
            switch (_context2.prev = _context2.next) {
              case 0:
                job = this.config.jobs.find(function (j) {
                  return j.name === name;
                });

                if (job) {
                  _context2.next = 3;
                  break;
                }

                throw new Error("Job \"".concat(name, "\" does not exist"));

              case 3:
                _context2.next = 5;
                return this.stop(name);

              case 5:
                this.config.jobs = this.config.jobs.filter(function (j) {
                  return j.name !== name;
                });

              case 6:
              case "end":
                return _context2.stop();
            }
          }
        }, _callee2, this);
      }));

      function remove(_x2) {
        return _remove.apply(this, arguments);
      }

      return remove;
    }()
  }]);
  return Bree;
}(EventEmitter); // Expose bthreads (useful for tests)
// https://github.com/chjj/bthreads#api


Bree.threads = {
  backend: threads.backend,
  browser: threads.browser,
  location: threads.location,
  filename: threads.filename,
  dirname: threads.dirname,
  require: threads.require,
  resolve: threads.resolve,
  exit: threads.exit,
  cores: threads.cores
}; // plugins inspired by Dayjs

Bree.extend = function (plugin, options) {
  if (!plugin.$i) {
    // install plugin only once
    plugin(options, Bree);
    plugin.$i = true;
  }

  return Bree;
};

module.exports = Bree;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pbmRleC5qcyJdLCJuYW1lcyI6WyJFdmVudEVtaXR0ZXIiLCJyZXF1aXJlIiwiZnMiLCJyZXNvbHZlIiwicFdhaXRGb3IiLCJjb21iaW5lRXJyb3JzIiwiZGVidWciLCJpc1NBTkIiLCJpc1ZhbGlkUGF0aCIsImxhdGVyIiwidGhyZWFkcyIsInNldFRpbWVvdXQiLCJzZXRJbnRlcnZhbCIsImlzU2NoZWR1bGUiLCJnZXROYW1lIiwiZ2V0SHVtYW5Ub01zIiwicGFyc2VWYWx1ZSIsImdldEpvYk5hbWVzIiwiYnVpbGRKb2IiLCJ2YWxpZGF0ZUpvYiIsIkJ1ZmZlciIsIkJyZWUiLCJjb25maWciLCJsb2dnZXIiLCJjb25zb2xlIiwicm9vdCIsImJyb3dzZXIiLCJ0aW1lb3V0IiwiaW50ZXJ2YWwiLCJqb2JzIiwiaGFzU2Vjb25kcyIsImNyb25WYWxpZGF0ZSIsImNsb3NlV29ya2VyQWZ0ZXJNcyIsImRlZmF1bHRFeHRlbnNpb24iLCJ3b3JrZXIiLCJlcnJvckhhbmRsZXIiLCJ3b3JrZXJNZXNzYWdlSGFuZGxlciIsIm91dHB1dFdvcmtlck1ldGFkYXRhIiwicHJlc2V0Iiwib3ZlcnJpZGUiLCJ1c2VTZWNvbmRzIiwid29ya2VycyIsInRpbWVvdXRzIiwiaW50ZXJ2YWxzIiwiZ2V0V29ya2VyTWV0YWRhdGEiLCJiaW5kIiwicnVuIiwic3RhcnQiLCJzdG9wIiwiYWRkIiwicmVtb3ZlIiwiaW5pdCIsInN0YXRzIiwic3RhdFN5bmMiLCJpc0RpcmVjdG9yeSIsIkVycm9yIiwiQXJyYXkiLCJpc0FycmF5IiwibGVuZ3RoIiwiZXJyIiwiZXJyb3IiLCJUeXBlRXJyb3IiLCJlcnJvcnMiLCJpIiwibmFtZXMiLCJwdXNoIiwibmFtZSIsIm1ldGEiLCJqb2IiLCJmaW5kIiwiaiIsIm1lc3NhZ2UiLCJ1bmRlZmluZWQiLCJpc01haW5UaHJlYWQiLCJyZXNvdXJjZUxpbWl0cyIsInRocmVhZElkIiwid2FybiIsIm9iamVjdCIsIndvcmtlckRhdGEiLCJXb3JrZXIiLCJwYXRoIiwiZW1pdCIsInByZWZpeCIsIm9uIiwiTnVtYmVyIiwiaXNGaW5pdGUiLCJ0ZXJtaW5hdGUiLCJpbmZvIiwibWV0YWRhdGEiLCJyZW1vdmVBbGxMaXN0ZW5lcnMiLCJjb2RlIiwibGV2ZWwiLCJkYXRlIiwiRGF0ZSIsImdldFRpbWUiLCJub3ciLCJjbGVhciIsIm9uY2UiLCJwb3N0TWVzc2FnZSIsIk9iamVjdCIsImtleXMiLCJhZGRlZEpvYnMiLCJlbnRyaWVzIiwiam9iXyIsImZpbHRlciIsImJhY2tlbmQiLCJsb2NhdGlvbiIsImZpbGVuYW1lIiwiZGlybmFtZSIsImV4aXQiLCJjb3JlcyIsImV4dGVuZCIsInBsdWdpbiIsIm9wdGlvbnMiLCIkaSIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLElBQU1BLFlBQVksR0FBR0MsT0FBTyxDQUFDLFFBQUQsQ0FBNUI7O0FBQ0EsSUFBTUMsRUFBRSxHQUFHRCxPQUFPLENBQUMsSUFBRCxDQUFsQjs7ZUFDb0JBLE9BQU8sQ0FBQyxNQUFELEM7SUFBbkJFLE8sWUFBQUEsTzs7QUFDUixJQUFNQyxRQUFRLEdBQUdILE9BQU8sQ0FBQyxZQUFELENBQXhCOztBQUNBLElBQU1JLGFBQWEsR0FBR0osT0FBTyxDQUFDLGdCQUFELENBQTdCOztBQUNBLElBQU1LLEtBQUssR0FBR0wsT0FBTyxDQUFDLE9BQUQsQ0FBUCxDQUFpQixNQUFqQixDQUFkOztBQUNBLElBQU1NLE1BQU0sR0FBR04sT0FBTyxDQUFDLHlCQUFELENBQXRCOztBQUNBLElBQU1PLFdBQVcsR0FBR1AsT0FBTyxDQUFDLGVBQUQsQ0FBM0I7O0FBQ0EsSUFBTVEsS0FBSyxHQUFHUixPQUFPLENBQUMsZUFBRCxDQUFyQjs7QUFDQSxJQUFNUyxPQUFPLEdBQUdULE9BQU8sQ0FBQyxVQUFELENBQXZCOztnQkFDb0NBLE9BQU8sQ0FBQyxhQUFELEM7SUFBbkNVLFUsYUFBQUEsVTtJQUFZQyxX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Q29udGVudCI6WyJjb25zdCBFdmVudEVtaXR0ZXIgPSByZXF1aXJlKCdldmVudHMnKTtcbmNvbnN0IGZzID0gcmVxdWlyZSgnZnMnKTtcbmNvbnN0IHsgcmVzb2x2ZSB9ID0gcmVxdWlyZSgncGF0aCcpO1xuY29uc3QgcFdhaXRGb3IgPSByZXF1aXJlKCdwLXdhaXQtZm9yJyk7XG5jb25zdCBjb21iaW5lRXJyb3JzID0gcmVxdWlyZSgnY29tYmluZS1lcnJvcnMnKTtcbmNvbnN0IGRlYnVnID0gcmVxdWlyZSgnZGVidWcnKSgnYnJlZScpO1xuY29uc3QgaXNTQU5CID0gcmVxdWlyZSgnaXMtc3RyaW5nLWFuZC1ub3QtYmxhbmsnKTtcbmNvbnN0IGlzVmFsaWRQYXRoID0gcmVxdWlyZSgnaXMtdmFsaWQtcGF0aCcpO1xuY29uc3QgbGF0ZXIgPSByZXF1aXJlKCdAYnJlZWpzL2xhdGVyJyk7XG5jb25zdCB0aHJlYWRzID0gcmVxdWlyZSgnYnRocmVhZHMnKTtcbmNvbnN0IHsgc2V0VGltZW91dCwgc2V0SW50ZXJ2YWwgfSA9IHJlcXVpcmUoJ3NhZmUtdGltZXJzJyk7XG5cbmNvbnN0IHtcbiAgaXNTY2hlZHVsZSxcbiAgZ2V0TmFtZSxcbiAgZ2V0SHVtYW5Ub01zLFxuICBwYXJzZVZhbHVlLFxuICBnZXRKb2JOYW1lc1xufSA9IHJlcXVpcmUoJy4vam9iLXV0aWxzJyk7XG5jb25zdCBidWlsZEpvYiA9IHJlcXVpcmUoJy4vam9iLWJ1aWxkZXInKTtcbmNvbnN0IHZhbGlkYXRlSm9iID0gcmVxdWlyZSgnLi9qb2ItdmFsaWRhdG9yJyk7XG5cbi8vIEJ0aHJlYWRzIHJlcXVpcmVzIHVzIHRvIGRvIHRoaXMgZm9yIHdlYiB3b3JrZXJzIChzZWUgYnRocmVhZHMgZG9jcyBmb3IgaW5zaWdodClcbnRocmVhZHMuQnVmZmVyID0gQnVmZmVyO1xuXG4vLyBJbnN0ZWFkIG9mIGB0aHJlYWRzLmJyb3dzZXJgIGNoZWNrcyBiZWxvdywgd2UgcHJldmlvdXNseSB1c2VkIHRoaXMgYm9vbGVhblxuLy8gY29uc3QgaGFzRnNTdGF0U3luYyA9IHR5cGVvZiBmcyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIGZzLnN0YXRTeW5jID09PSAnZnVuY3Rpb24nO1xuXG5jbGFzcyBCcmVlIGV4dGVuZHMgRXZlbnRFbWl0dGVyIHtcbiAgY29uc3RydWN0b3IoY29uZmlnKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLmNvbmZpZyA9IHtcbiAgICAgIC8vIFdlIHJlY29tbWVuZCB1c2luZyBDYWJpbiBmb3IgbG9nZ2luZ1xuICAgICAgLy8gPGh0dHBzOi8vY2FiaW5qcy5jb20+XG4gICAgICBsb2dnZXI6IGNvbnNvbGUsXG4gICAgICAvLyBTZXQgdGhpcyB0byBgZmFsc2VgIHRvIHByZXZlbnQgcmVxdWlyaW5nIGEgcm9vdCBkaXJlY3Rvcnkgb2Ygam9ic1xuICAgICAgLy8gKGUuZy4gaWYgeW91ciBqb2JzIGFyZSBub3QgYWxsIGluIG9uZSBkaXJlY3RvcnkpXG4gICAgICByb290OiB0aHJlYWRzLmJyb3dzZXIgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi9cbiAgICAgICAgPyB0aHJlYWRzLnJlc29sdmUoJ2pvYnMnKVxuICAgICAgICA6IHJlc29sdmUoJ2pvYnMnKSxcbiAgICAgIC8vIERlZmF1bHQgdGltZW91dCBmb3Igam9ic1xuICAgICAgLy8gKHNldCB0aGlzIHRvIGBmYWxzZWAgaWYgeW91IGRvIG5vdCB3aXNoIGZvciBhIGRlZmF1bHQgdGltZW91dCB0byBiZSBzZXQpXG4gICAgICB0aW1lb3V0OiAwLFxuICAgICAgLy8gRGVmYXVsdCBpbnRlcnZhbCBmb3Igam9ic1xuICAgICAgLy8gKHNldCB0aGlzIHRvIGAwYCBmb3Igbm8gaW50ZXJ2YWwsIGFuZCA+IDAgZm9yIGEgZGVmYXVsdCBpbnRlcnZhbCB0byBiZSBzZXQpXG4gICAgICBpbnRlcnZhbDogMCxcbiAgICAgIC8vIFRoaXMgaXMgYW4gQXJyYXkgb2YgeW91ciBqb2IgZGVmaW5pdGlvbnMgKHNlZSBSRUFETUUgZm9yIGV4YW1wbGVzKVxuICAgICAgam9iczogW10sXG4gICAgICAvLyA8aHR0cHM6Ly9icmVlanMuZ2l0aHViLmlvL2xhdGVyL3BhcnNlcnMuaHRtbCNjcm9uPlxuICAgICAgLy8gKGNhbiBiZSBvdmVycmlkZGVuIG9uIGEgam9iIGJhc2lzIHdpdGggc2FtZSBwcm9wIG5hbWUpXG4gICAgICBoYXNTZWNvbmRzOiBmYWxzZSxcbiAgICAgIC8vIDxodHRwczovL2dpdGh1Yi5jb20vQWlyZm9vb3gvY3Jvbi12YWxpZGF0ZT5cbiAgICAgIGNyb25WYWxpZGF0ZToge30sXG4gICAgICAvLyBJZiB5b3Ugc2V0IGEgdmFsdWUgPiAwIGhlcmUsIHRoZW4gaXQgd2lsbCB0ZXJtaW5hdGUgd29ya2VycyBhZnRlciB0aGlzIHRpbWUgKG1zKVxuICAgICAgY2xvc2VXb3JrZXJBZnRlck1zOiAwLFxuICAgICAgLy8gQ291bGQgYWxzbyBiZSBtanMgaWYgZGVzaXJlZFxuICAgICAgLy8gKHRoaXMgaXMgdGhlIGRlZmF1bHQgZXh0ZW5zaW9uIGlmIHlvdSBqdXN0IHNwZWNpZnkgYSBqb2IncyBuYW1lIHdpdGhvdXQgXCIuanNcIiBvciBcIi5tanNcIilcbiAgICAgIGRlZmF1bHRFeHRlbnNpb246ICdqcycsXG4gICAgICAvLyBEZWZhdWx0IHdvcmtlciBvcHRpb25zIHRvIHBhc3MgdG8gfmBuZXcgV29ya2VyYH4gYG5ldyB0aHJlYWRzLldvcmtlcmBcbiAgICAgIC8vIChjYW4gYmUgb3ZlcnJpZGRlbiBvbiBhIHBlciBqb2IgYmFzaXMpXG4gICAgICAvLyA8aHR0cHM6Ly9ub2RlanMub3JnL2FwaS93b3JrZXJfdGhyZWFkcy5odG1sI3dvcmtlcl90aHJlYWRzX25ld193b3JrZXJfZmlsZW5hbWVfb3B0aW9ucz5cbiAgICAgIHdvcmtlcjoge30sXG4gICAgICAvLyBDdXN0b20gaGFuZGxlciB0byBleGVjdXRlIHdoZW4gZXJyb3IgZXZlbnRzIGFyZSBlbWl0dGVkIGJ5IHRoZSB3b3JrZXJzIG9yIHdoZW4gdGhleSBleGl0XG4gICAgICAvLyB3aXRoIG5vbi16ZXJvIGNvZGVcbiAgICAgIC8vIHBhc3MgaW4gYSBjYWxsYmFjayBmdW5jdGlvbiB3aXRoIGZvbGxvd2luZyBzaWduYXR1cmU6IGAoZXJyb3IsIHdvcmtlck1ldGFkYXRhKSA9PiB7IC8vIGN1c3RvbSBoYW5kbGluZyBoZXJlIH1gXG4gICAgICBlcnJvckhhbmRsZXI6IG51bGwsXG4gICAgICAvLyBDdXN0b20gaGFuZGxlciBleGVjdXRlZCB3aGVuIGEgYG1lc3NhZ2VgIGV2ZW50IGlzIHJlY2VpdmVkIGZyb20gYSB3b3JrZXIuXG4gICAgICAvLyBBIHNwZWNpYWwgJ2RvbmUnIGV2ZW4gaXMgYWxzbyBicm9hZGNhc3RlZCB3aGlsZSBsZWF2aW5nIHdvcmtlciBzaHV0ZG93biBsb2dpYyBpbiBwbGFjZS5cbiAgICAgIHdvcmtlck1lc3NhZ2VIYW5kbGVyOiBudWxsLFxuICAgICAgLy9cbiAgICAgIC8vIGlmIHlvdSBzZXQgdGhpcyB0byBgdHJ1ZWAsIHRoZW4gYSBzZWNvbmQgYXJnIGlzIHBhc3NlZCB0byBsb2cgb3V0cHV0XG4gICAgICAvLyBhbmQgaXQgd2lsbCBiZSBhbiBPYmplY3Qgd2l0aCBgeyB3b3JrZXI6IE9iamVjdCB9YCBzZXQsIGZvciBleGFtcGxlOlxuICAgICAgLy8gKHNlZSB0aGUgZG9jdW1lbnRhdGlvbiBhdCA8aHR0cHM6Ly9ub2RlanMub3JnL2FwaS93b3JrZXJfdGhyZWFkcy5odG1sPiBmb3IgbW9yZSBpbnNpZ2h0KVxuICAgICAgLy9cbiAgICAgIC8vIGxvZ2dlci5pbmZvKCcuLi4nLCB7XG4gICAgICAvLyAgIHdvcmtlcjoge1xuICAgICAgLy8gICAgIGlzTWFpblRocmVhZDogQm9vbGVhblxuICAgICAgLy8gICAgIHJlc291cmNlTGltaXRzOiBPYmplY3QsXG4gICAgICAvLyAgICAgdGhyZWFkSWQ6IFN0cmluZ1xuICAgICAgLy8gICB9XG4gICAgICAvLyB9KTtcbiAgICAgIC8vXG4gICAgICBvdXRwdXRXb3JrZXJNZXRhZGF0YTogZmFsc2UsXG4gICAgICAuLi5jb25maWdcbiAgICB9O1xuXG4gICAgLy9cbiAgICAvLyBpZiBgaGFzU2Vjb25kc2AgaXMgYHRydWVgIHRoZW4gZW5zdXJlIHRoYXRcbiAgICAvLyBgY3JvblZhbGlkYXRlYCBvYmplY3QgaGFzIGBvdmVycmlkZWAgb2JqZWN0IHdpdGggYHVzZVNlY29uZHNgIHNldCB0byBgdHJ1ZWBcbiAgICAvLyA8aHR0cHM6Ly9naXRodWIuY29tL2JyZWVqcy9icmVlL2lzc3Vlcy83PlxuICAgIC8vXG4gICAgaWYgKHRoaXMuY29uZmlnLmhhc1NlY29uZHMpIHtcbiAgICAgIHRoaXMuY29uZmlnLmNyb25WYWxpZGF0ZSA9IHtcbiAgICAgICAgLi4udGhpcy5jb25maWcuY3JvblZhbGlkYXRlLFxuICAgICAgICBwcmVzZXQ6XG4gICAgICAgICAgdGhpcy5jb25maWcuY3JvblZhbGlkYXRlICYmIHRoaXMuY29uZmlnLmNyb25WYWxpZGF0ZS5wcmVzZXRcbiAgICAgICAgICAgID8gdGhpcy5jb25maWcuY3JvblZhbGlkYXRlLnByZXNldFxuICAgICAgICAgICAgOiAnZGVmYXVsdCcsXG4gICAgICAgIG92ZXJyaWRlOiB7XG4gICAgICAgICAgLi4uKHRoaXMuY29uZmlnLmNyb25WYWxpZGF0ZSAmJiB0aGlzLmNvbmZpZy5jcm9uVmFsaWRhdGUub3ZlcnJpZGVcbiAgICAgICAgICAgID8gdGhpcy5jb25maWcuY3JvblZhbGlkYXRlLm92ZXJyaWRlXG4gICAgICAgICAgICA6IHt9KSxcbiAgICAgICAgICB1c2VTZWNvbmRzOiB0cnVlXG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfVxuXG4gICAgZGVidWcoJ2NvbmZpZycsIHRoaXMuY29uZmlnKTtcblxuICAgIHRoaXMuY2xvc2VXb3JrZXJBZnRlck1zID0ge307XG4gICAgdGhpcy53b3JrZXJzID0ge307XG4gICAgdGhpcy50aW1lb3V0cyA9IHt9O1xuICAgIHRoaXMuaW50ZXJ2YWxzID0ge307XG5cbiAgICB0aGlzLmlzU2NoZWR1bGUgPSBpc1NjaGVkdWxlO1xuICAgIHRoaXMuZ2V0V29ya2VyTWV0YWRhdGEgPSB0aGlzLmdldFdvcmtlck1ldGFkYXRhLmJpbmQodGhpcyk7XG4gICAgdGhpcy5ydW4gPSB0aGlzLnJ1bi5iaW5kKHRoaXMpO1xuICAgIHRoaXMuc3RhcnQgPSB0aGlzLnN0YXJ0LmJpbmQodGhpcyk7XG4gICAgdGhpcy5zdG9wID0gdGhpcy5zdG9wLmJpbmQodGhpcyk7XG4gICAgdGhpcy5hZGQgPSB0aGlzLmFkZC5iaW5kKHRoaXMpO1xuICAgIHRoaXMucmVtb3ZlID0gdGhpcy5yZW1vdmUuYmluZCh0aGlzKTtcblxuICAgIHRoaXMudmFsaWRhdGVKb2IgPSB2YWxpZGF0ZUpvYjtcbiAgICB0aGlzLmdldE5hbWUgPSBnZXROYW1lO1xuICAgIHRoaXMuZ2V0SHVtYW5Ub01zID0gZ2V0SHVtYW5Ub01zO1xuICAgIHRoaXMucGFyc2VWYWx1ZSA9IHBhcnNlVmFsdWU7XG5cbiAgICAvLyBzbyBwbHVnaW5zIGNhbiBleHRlbmQgY29uc3RydWN0b3JcbiAgICB0aGlzLmluaXQgPSB0aGlzLmluaXQuYmluZCh0aGlzKTtcbiAgICB0aGlzLmluaXQoKTtcblxuICAgIGRlYnVnKCd0aGlzLmNvbmZpZy5qb2JzJywgdGhpcy5jb25maWcuam9icyk7XG4gIH1cblxuICBpbml0KCkge1xuICAgIC8vIFZhbGlkYXRlIHJvb3QgKHN5bmMgY2hlY2spXG4gICAgaWYgKGlzU0FOQih0aGlzLmNvbmZpZy5yb290KSkge1xuICAgICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi9cbiAgICAgIGlmICghdGhyZWFkcy5icm93c2VyICYmIGlzVmFsaWRQYXRoKHRoaXMuY29uZmlnLnJvb3QpKSB7XG4gICAgICAgIGNvbnN0IHN0YXRzID0gZnMuc3RhdFN5bmModGhpcy5jb25maWcucm9vdCk7XG4gICAgICAgIGlmICghc3RhdHMuaXNEaXJlY3RvcnkoKSkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgIGBSb290IGRpcmVjdG9yeSBvZiAke3RoaXMuY29uZmlnLnJvb3R9IGRvZXMgbm90IGV4aXN0YFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBWYWxpZGF0ZSB0aW1lb3V0XG4gICAgdGhpcy5jb25maWcudGltZW91dCA9IHRoaXMucGFyc2VWYWx1ZSh0aGlzLmNvbmZpZy50aW1lb3V0KTtcbiAgICBkZWJ1ZygndGltZW91dCcsIHRoaXMuY29uZmlnLnRpbWVvdXQpO1xuXG4gICAgLy8gVmFsaWRhdGUgaW50ZXJ2YWxcbiAgICB0aGlzLmNvbmZpZy5pbnRlcnZhbCA9IHRoaXMucGFyc2VWYWx1ZSh0aGlzLmNvbmZpZy5pbnRlcnZhbCk7XG4gICAgZGVidWcoJ2ludGVydmFsJywgdGhpcy5jb25maWcuaW50ZXJ2YWwpO1xuXG4gICAgLy9cbiAgICAvLyBpZiBgdGhpcy5jb25maWcuam9ic2AgaXMgYW4gZW1wdHkgYXJyYXlcbiAgICAvLyB0aGVuIHdlIHNob3VsZCB0cnkgdG8gbG9hZCBgam9icy9pbmRleC5qc2BcbiAgICAvL1xuICAgIGlmIChcbiAgICAgIHRoaXMuY29uZmlnLnJvb3QgJiZcbiAgICAgICghQXJyYXkuaXNBcnJheSh0aGlzLmNvbmZpZy5qb2JzKSB8fCB0aGlzLmNvbmZpZy5qb2JzLmxlbmd0aCA9PT0gMClcbiAgICApIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHRoaXMuY29uZmlnLmpvYnMgPSB0aHJlYWRzLnJlcXVpcmUodGhpcy5jb25maWcucm9vdCk7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgdGhpcy5jb25maWcubG9nZ2VyLmVycm9yKGVycik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy9cbiAgICAvLyB2YWxpZGF0ZSBqb2JzXG4gICAgLy9cbiAgICBpZiAoIUFycmF5LmlzQXJyYXkodGhpcy5jb25maWcuam9icykpIHtcbiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0pvYnMgbXVzdCBiZSBhbiBBcnJheScpO1xuICAgIH1cblxuICAgIC8vIFByb3ZpZGUgaHVtYW4tZnJpZW5kbHkgZXJyb3JzIGZvciBjb21wbGV4IGNvbmZpZ3VyYXRpb25zXG4gICAgY29uc3QgZXJyb3JzID0gW107XG5cbiAgICAvKlxuICAgIEpvYnMgPSBbXG4gICAgICAnbmFtZScsXG4gICAgICB7IG5hbWU6ICdib290JyB9LFxuICAgICAgeyBuYW1lOiAndGltZW91dCcsIHRpbWVvdXQ6IG1zKCczcycpIH0sXG4gICAgICB7IG5hbWU6ICdjcm9uJywgY3JvbjogJyogKiAqICogKicgfSxcbiAgICAgIHsgbmFtZTogJ2Nyb24gd2l0aCB0aW1lb3V0JywgdGltZW91dDogJzNzJywgY3JvbjogJyogKiAqICogKicgfSxcbiAgICAgIHsgbmFtZTogJ2ludGVydmFsJywgaW50ZXJ2YWw6IG1zKCc0cycpIH1cbiAgICAgIHsgbmFtZTogJ2ludGVydmFsJywgcGF0aDogJy9zb21lL3BhdGgvdG8vc2NyaXB0LmpzJywgaW50ZXJ2YWw6IG1zKCc0cycpIH0sXG4gICAgICB7IG5hbWU6ICd0aW1lb3V0JywgdGltZW91dDogJ3RocmVlIG1pbnV0ZXMnIH0sXG4gICAgICB7IG5hbWU6ICdpbnRlcnZhbCcsIGludGVydmFsOiAnb25lIG1pbnV0ZScgfSxcbiAgICAgIHsgbmFtZTogJ3RpbWVvdXQnLCB0aW1lb3V0OiAnM3MnIH0sXG4gICAgICB7IG5hbWU6ICdpbnRlcnZhbCcsIGludGVydmFsOiAnMzBkJyB9LFxuICAgICAgeyBuYW1lOiAnc2NoZWR1bGUgb2JqZWN0JywgaW50ZXJ2YWw6IHsgc2NoZWR1bGVzOiBbXSB9IH1cbiAgICBdXG4gICAgKi9cblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5jb25maWcuam9icy5sZW5ndGg7IGkrKykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgbmFtZXMgPSBnZXRKb2JOYW1lcyh0aGlzLmNvbmZpZy5qb2JzLCBpKTtcblxuICAgICAgICB2YWxpZGF0ZUpvYih0aGlzLmNvbmZpZy5qb2JzW2ldLCBpLCBuYW1lcywgdGhpcy5jb25maWcpO1xuXG4gICAgICAgIHRoaXMuY29uZmlnLmpvYnNbaV0gPSBidWlsZEpvYih0aGlzLmNvbmZpZy5qb2JzW2ldLCB0aGlzLmNvbmZpZyk7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgZXJyb3JzLnB1c2goZXJyKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBJZiB0aGVyZSB3ZXJlIGFueSBlcnJvcnMgdGhlbiB0aHJvdyB0aGVtXG4gICAgaWYgKGVycm9ycy5sZW5ndGggPiAwKSB7XG4gICAgICB0aHJvdyBjb21iaW5lRXJyb3JzKGVycm9ycyk7XG4gICAgfVxuICB9XG5cbiAgZ2V0V29ya2VyTWV0YWRhdGEobmFtZSwgbWV0YSA9IHt9KSB7XG4gICAgY29uc3Qgam9iID0gdGhpcy5jb25maWcuam9icy5maW5kKChqKSA9PiBqLm5hbWUgPT09IG5hbWUpO1xuICAgIGlmICgham9iKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEpvYiBcIiR7bmFtZX1cIiBkb2VzIG5vdCBleGlzdGApO1xuICAgIH1cblxuICAgIGlmICghdGhpcy5jb25maWcub3V0cHV0V29ya2VyTWV0YWRhdGEgJiYgIWpvYi5vdXRwdXRXb3JrZXJNZXRhZGF0YSkge1xuICAgICAgcmV0dXJuIG1ldGEgJiZcbiAgICAgICAgKHR5cGVvZiBtZXRhLmVyciAhPT0gJ3VuZGVmaW5lZCcgfHwgdHlwZW9mIG1ldGEubWVzc2FnZSAhPT0gJ3VuZGVmaW5lZCcpXG4gICAgICAgID8gbWV0YVxuICAgICAgICA6IHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy53b3JrZXJzW25hbWVdXG4gICAgICA/IHtcbiAgICAgICAgICAuLi5tZXRhLFxuICAgICAgICAgIHdvcmtlcjoge1xuICAgICAgICAgICAgaXNNYWluVGhyZWFkOiB0aGlzLndvcmtlcnNbbmFtZV0uaXNNYWluVGhyZWFkLFxuICAgICAgICAgICAgcmVzb3VyY2VMaW1pdHM6IHRoaXMud29ya2Vyc1tuYW1lXS5yZXNvdXJjZUxpbWl0cyxcbiAgICAgICAgICAgIHRocmVhZElkOiB0aGlzLndvcmtlcnNbbmFtZV0udGhyZWFkSWRcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIDogbWV0YTtcbiAgfVxuXG4gIHJ1bihuYW1lKSB7XG4gICAgZGVidWcoJ3J1bicsIG5hbWUpO1xuICAgIGlmIChuYW1lKSB7XG4gICAgICBjb25zdCBqb2IgPSB0aGlzLmNvbmZpZy5qb2JzLmZpbmQoKGopID0+IGoubmFtZSA9PT0gbmFtZSk7XG4gICAgICBpZiAoIWpvYikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEpvYiBcIiR7bmFtZX1cIiBkb2VzIG5vdCBleGlzdGApO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy53b3JrZXJzW25hbWVdKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbmZpZy5sb2dnZXIud2FybihcbiAgICAgICAgICBuZXcgRXJyb3IoYEpvYiBcIiR7bmFtZX1cIiBpcyBhbHJlYWR5IHJ1bm5pbmdgKSxcbiAgICAgICAgICB0aGlzLmdldFdvcmtlck1ldGFkYXRhKG5hbWUpXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIGRlYnVnKCdzdGFydGluZyB3b3JrZXInLCBuYW1lKTtcbiAgICAgIGNvbnN0IG9iamVjdCA9IHtcbiAgICAgICAgLi4uKHRoaXMuY29uZmlnLndvcmtlciA/IHRoaXMuY29uZmlnLndvcmtlciA6IHt9KSxcbiAgICAgICAgLi4uKGpvYi53b3JrZXIgPyBqb2Iud29ya2VyIDoge30pLFxuICAgICAgICB3b3JrZXJEYXRhOiB7XG4gICAgICAgICAgam9iLFxuICAgICAgICAgIC4uLih0aGlzLmNvbmZpZy53b3JrZXIgJiYgdGhpcy5jb25maWcud29ya2VyLndvcmtlckRhdGFcbiAgICAgICAgICAgID8gdGhpcy5jb25maWcud29ya2VyLndvcmtlckRhdGFcbiAgICAgICAgICAgIDoge30pLFxuICAgICAgICAgIC4uLihqb2Iud29ya2VyICYmIGpvYi53b3JrZXIud29ya2VyRGF0YSA/IGpvYi53b3JrZXIud29ya2VyRGF0YSA6IHt9KVxuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgdGhpcy53b3JrZXJzW25hbWVdID0gbmV3IHRocmVhZHMuV29ya2VyKGpvYi5wYXRoLCBvYmplY3QpO1xuICAgICAgdGhpcy5lbWl0KCd3b3JrZXIgY3JlYXRlZCcsIG5hbWUpO1xuICAgICAgZGVidWcoJ3dvcmtlciBzdGFydGVkJywgbmFtZSk7XG5cbiAgICAgIGNvbnN0IHByZWZpeCA9IGBXb3JrZXIgZm9yIGpvYiBcIiR7bmFtZX1cImA7XG4gICAgICB0aGlzLndvcmtlcnNbbmFtZV0ub24oJ29ubGluZScsICgpID0+IHtcbiAgICAgICAgLy8gSWYgd2Ugc3BlY2lmaWVkIGEgdmFsdWUgZm9yIGBjbG9zZVdvcmtlckFmdGVyTXNgXG4gICAgICAgIC8vIHRoZW4gd2UgbmVlZCB0byB0ZXJtaW5hdGUgaXQgYWZ0ZXIgdGhhdCBleGVjdXRpb24gdGltZVxuICAgICAgICBjb25zdCBjbG9zZVdvcmtlckFmdGVyTXMgPSBOdW1iZXIuaXNGaW5pdGUoam9iLmNsb3NlV29ya2VyQWZ0ZXJNcylcbiAgICAgICAgICA/IGpvYi5jbG9zZVdvcmtlckFmdGVyTXNcbiAgICAgICAgICA6IHRoaXMuY29uZmlnLmNsb3NlV29ya2VyQWZ0ZXJNcztcbiAgICAgICAgaWYgKE51bWJlci5pc0Zpbml0ZShjbG9zZVdvcmtlckFmdGVyTXMpICYmIGNsb3NlV29ya2VyQWZ0ZXJNcyA+IDApIHtcbiAgICAgICAgICBkZWJ1Zygnd29ya2VyIGhhcyBjbG9zZSBzZXQnLCBuYW1lLCBjbG9zZVdvcmtlckFmdGVyTXMpO1xuICAgICAgICAgIHRoaXMuY2xvc2VXb3JrZXJBZnRlck1zW25hbWVdID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgZWxzZSAqL1xuICAgICAgICAgICAgaWYgKHRoaXMud29ya2Vyc1tuYW1lXSkge1xuICAgICAgICAgICAgICBkZWJ1Zygnd29ya2VyIGhhcyBiZWVuIHRlcm1pbmF0ZWQnLCBuYW1lKTtcbiAgICAgICAgICAgICAgdGhpcy53b3JrZXJzW25hbWVdLnRlcm1pbmF0ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sIGNsb3NlV29ya2VyQWZ0ZXJNcyk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmNvbmZpZy5sb2dnZXIuaW5mbyhcbiAgICAgICAgICBgJHtwcmVmaXh9IG9ubGluZWAsXG4gICAgICAgICAgdGhpcy5nZXRXb3JrZXJNZXRhZGF0YShuYW1lKVxuICAgICAgICApO1xuICAgICAgfSk7XG4gICAgICB0aGlzLndvcmtlcnNbbmFtZV0ub24oJ21lc3NhZ2UnLCAobWVzc2FnZSkgPT4ge1xuICAgICAgICBjb25zdCBtZXRhZGF0YSA9IHRoaXMuZ2V0V29ya2VyTWV0YWRhdGEobmFtZSwgeyBtZXNzYWdlIH0pO1xuXG4gICAgICAgIGlmICh0aGlzLmNvbmZpZy53b3JrZXJNZXNzYWdlSGFuZGxlcikge1xuICAgICAgICAgIHRoaXMuY29uZmlnLndvcmtlck1lc3NhZ2VIYW5kbGVyKHtcbiAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICAuLi5tZXRhZGF0YVxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2UgaWYgKG1lc3NhZ2UgPT09ICdkb25lJykge1xuICAgICAgICAgIHRoaXMuY29uZmlnLmxvZ2dlci5pbmZvKGAke3ByZWZpeH0gc2lnbmFsZWQgY29tcGxldGlvbmAsIG1ldGFkYXRhKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLmNvbmZpZy5sb2dnZXIuaW5mbyhgJHtwcmVmaXh9IHNlbnQgYSBtZXNzYWdlYCwgbWV0YWRhdGEpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG1lc3NhZ2UgPT09ICdkb25lJykge1xuICAgICAgICAgIHRoaXMud29ya2Vyc1tuYW1lXS5yZW1vdmVBbGxMaXN0ZW5lcnMoJ21lc3NhZ2UnKTtcbiAgICAgICAgICB0aGlzLndvcmtlcnNbbmFtZV0ucmVtb3ZlQWxsTGlzdGVuZXJzKCdleGl0Jyk7XG4gICAgICAgICAgdGhpcy53b3JrZXJzW25hbWVdLnRlcm1pbmF0ZSgpO1xuICAgICAgICAgIGRlbGV0ZSB0aGlzLndvcmtlcnNbbmFtZV07XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgLy8gTk9URTogeW91IGNhbm5vdCBjYXRjaCBtZXNzYWdlZXJyb3Igc2luY2UgaXQgaXMgYSBOb2RlIGludGVybmFsXG4gICAgICAvLyAgICAgICAoaWYgYW55b25lIGhhcyBhbnkgaWRlYSBob3cgdG8gY2F0Y2ggdGhpcyBpbiB0ZXN0cyBsZXQgdXMga25vdylcbiAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovXG4gICAgICB0aGlzLndvcmtlcnNbbmFtZV0ub24oJ21lc3NhZ2VlcnJvcicsIChlcnIpID0+IHtcbiAgICAgICAgaWYgKHRoaXMuY29uZmlnLmVycm9ySGFuZGxlcikge1xuICAgICAgICAgIHRoaXMuY29uZmlnLmVycm9ySGFuZGxlcihlcnIsIHtcbiAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICAuLi50aGlzLmdldFdvcmtlck1ldGFkYXRhKG5hbWUsIHsgZXJyIH0pXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5jb25maWcubG9nZ2VyLmVycm9yKFxuICAgICAgICAgICAgYCR7cHJlZml4fSBoYWQgYSBtZXNzYWdlIGVycm9yYCxcbiAgICAgICAgICAgIHRoaXMuZ2V0V29ya2VyTWV0YWRhdGEobmFtZSwgeyBlcnIgfSlcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHRoaXMud29ya2Vyc1tuYW1lXS5vbignZXJyb3InLCAoZXJyKSA9PiB7XG4gICAgICAgIGlmICh0aGlzLmNvbmZpZy5lcnJvckhhbmRsZXIpIHtcbiAgICAgICAgICB0aGlzLmNvbmZpZy5lcnJvckhhbmRsZXIoZXJyLCB7XG4gICAgICAgICAgICBuYW1lLFxuICAgICAgICAgICAgLi4udGhpcy5nZXRXb3JrZXJNZXRhZGF0YShuYW1lLCB7IGVyciB9KVxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMuY29uZmlnLmxvZ2dlci5lcnJvcihcbiAgICAgICAgICAgIGAke3ByZWZpeH0gaGFkIGFuIGVycm9yYCxcbiAgICAgICAgICAgIHRoaXMuZ2V0V29ya2VyTWV0YWRhdGEobmFtZSwgeyBlcnIgfSlcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHRoaXMud29ya2Vyc1tuYW1lXS5vbignZXhpdCcsIChjb2RlKSA9PiB7XG4gICAgICAgIGNvbnN0IGxldmVsID0gY29kZSA9PT0gMCA/ICdpbmZvJyA6ICdlcnJvcic7XG4gICAgICAgIGlmIChsZXZlbCA9PT0gJ2Vycm9yJyAmJiB0aGlzLmNvbmZpZy5lcnJvckhhbmRsZXIpIHtcbiAgICAgICAgICB0aGlzLmNvbmZpZy5lcnJvckhhbmRsZXIoXG4gICAgICAgICAgICBuZXcgRXJyb3IoYCR7cHJlZml4fSBleGl0ZWQgd2l0aCBjb2RlICR7Y29kZX1gKSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgLi4udGhpcy5nZXRXb3JrZXJNZXRhZGF0YShuYW1lKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5jb25maWcubG9nZ2VyW2xldmVsXShcbiAgICAgICAgICAgIGAke3ByZWZpeH0gZXhpdGVkIHdpdGggY29kZSAke2NvZGV9YCxcbiAgICAgICAgICAgIHRoaXMuZ2V0V29ya2VyTWV0YWRhdGEobmFtZSlcbiAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgZGVsZXRlIHRoaXMud29ya2Vyc1tuYW1lXTtcbiAgICAgICAgdGhpcy5lbWl0KCd3b3JrZXIgZGVsZXRlZCcsIG5hbWUpO1xuICAgICAgfSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgZm9yIChjb25zdCBqb2Igb2YgdGhpcy5jb25maWcuam9icykge1xuICAgICAgdGhpcy5ydW4oam9iLm5hbWUpO1xuICAgIH1cbiAgfVxuXG4gIHN0YXJ0KG5hbWUpIHtcbiAgICBkZWJ1Zygnc3RhcnQnLCBuYW1lKTtcbiAgICBpZiAobmFtZSkge1xuICAgICAgY29uc3Qgam9iID0gdGhpcy5jb25maWcuam9icy5maW5kKChqKSA9PiBqLm5hbWUgPT09IG5hbWUpO1xuICAgICAgaWYgKCFqb2IpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBKb2IgJHtuYW1lfSBkb2VzIG5vdCBleGlzdGApO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy50aW1lb3V0c1tuYW1lXSB8fCB0aGlzLmludGVydmFsc1tuYW1lXSB8fCB0aGlzLndvcmtlcnNbbmFtZV0pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29uZmlnLmxvZ2dlci53YXJuKFxuICAgICAgICAgIG5ldyBFcnJvcihgSm9iIFwiJHtuYW1lfVwiIGlzIGFscmVhZHkgc3RhcnRlZGApXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIGRlYnVnKCdqb2InLCBqb2IpO1xuXG4gICAgICAvLyBDaGVjayBmb3IgZGF0ZSBhbmQgaWYgaXQgaXMgaW4gdGhlIHBhc3QgdGhlbiBkb24ndCBydW4gaXRcbiAgICAgIGlmIChqb2IuZGF0ZSBpbnN0YW5jZW9mIERhdGUpIHtcbiAgICAgICAgZGVidWcoJ2pvYiBkYXRlJywgam9iKTtcbiAgICAgICAgaWYgKGpvYi5kYXRlLmdldFRpbWUoKSA8IERhdGUubm93KCkpIHtcbiAgICAgICAgICBkZWJ1Zygnam9iIGRhdGUgd2FzIGluIHRoZSBwYXN0Jyk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy50aW1lb3V0c1tuYW1lXSA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgIHRoaXMucnVuKG5hbWUpO1xuICAgICAgICAgIGlmICh0aGlzLmlzU2NoZWR1bGUoam9iLmludGVydmFsKSkge1xuICAgICAgICAgICAgZGVidWcoJ2pvYi5pbnRlcnZhbCBpcyBzY2hlZHVsZScsIGpvYik7XG4gICAgICAgICAgICB0aGlzLmludGVydmFsc1tuYW1lXSA9IGxhdGVyLnNldEludGVydmFsKFxuICAgICAgICAgICAgICAoKSA9PiB0aGlzLnJ1bihuYW1lKSxcbiAgICAgICAgICAgICAgam9iLmludGVydmFsXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0gZWxzZSBpZiAoTnVtYmVyLmlzRmluaXRlKGpvYi5pbnRlcnZhbCkgJiYgam9iLmludGVydmFsID4gMCkge1xuICAgICAgICAgICAgZGVidWcoJ2pvYi5pbnRlcnZhbCBpcyBmaW5pdGUnLCBqb2IpO1xuICAgICAgICAgICAgdGhpcy5pbnRlcnZhbHNbbmFtZV0gPSBzZXRJbnRlcnZhbChcbiAgICAgICAgICAgICAgKCkgPT4gdGhpcy5ydW4obmFtZSksXG4gICAgICAgICAgICAgIGpvYi5pbnRlcnZhbFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZGVidWcoJ2pvYi5kYXRlIHdhcyBzY2hlZHVsZWQgdG8gcnVuIG9ubHkgb25jZScsIGpvYik7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgZGVsZXRlIHRoaXMudGltZW91dHNbbmFtZV07XG4gICAgICAgIH0sIGpvYi5kYXRlLmdldFRpbWUoKSAtIERhdGUubm93KCkpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIFRoaXMgaXMgb25seSBjb21wbGV4IGJlY2F1c2UgYm90aCB0aW1lb3V0IGFuZCBpbnRlcnZhbCBjYW4gYmUgYSBzY2hlZHVsZVxuICAgICAgaWYgKHRoaXMuaXNTY2hlZHVsZShqb2IudGltZW91dCkpIHtcbiAgICAgICAgZGVidWcoJ2pvYiB0aW1lb3V0IGlzIHNjaGVkdWxlJywgam9iKTtcbiAgICAgICAgdGhpcy50aW1lb3V0c1tuYW1lXSA9IGxhdGVyLnNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgIHRoaXMucnVuKG5hbWUpO1xuICAgICAgICAgIGlmICh0aGlzLmlzU2NoZWR1bGUoam9iLmludGVydmFsKSkge1xuICAgICAgICAgICAgZGVidWcoJ2pvYi5pbnRlcnZhbCBpcyBzY2hlZHVsZScsIGpvYik7XG4gICAgICAgICAgICB0aGlzLmludGVydmFsc1tuYW1lXSA9IGxhdGVyLnNldEludGVydmFsKFxuICAgICAgICAgICAgICAoKSA9PiB0aGlzLnJ1bihuYW1lKSxcbiAgICAgICAgICAgICAgam9iLmludGVydmFsXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0gZWxzZSBpZiAoTnVtYmVyLmlzRmluaXRlKGpvYi5pbnRlcnZhbCkgJiYgam9iLmludGVydmFsID4gMCkge1xuICAgICAgICAgICAgZGVidWcoJ2pvYi5pbnRlcnZhbCBpcyBmaW5pdGUnLCBqb2IpO1xuICAgICAgICAgICAgdGhpcy5pbnRlcnZhbHNbbmFtZV0gPSBzZXRJbnRlcnZhbChcbiAgICAgICAgICAgICAgKCkgPT4gdGhpcy5ydW4obmFtZSksXG4gICAgICAgICAgICAgIGpvYi5pbnRlcnZhbFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBkZWxldGUgdGhpcy50aW1lb3V0c1tuYW1lXTtcbiAgICAgICAgfSwgam9iLnRpbWVvdXQpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmIChOdW1iZXIuaXNGaW5pdGUoam9iLnRpbWVvdXQpKSB7XG4gICAgICAgIGRlYnVnKCdqb2IgdGltZW91dCBpcyBmaW5pdGUnLCBqb2IpO1xuICAgICAgICB0aGlzLnRpbWVvdXRzW25hbWVdID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgdGhpcy5ydW4obmFtZSk7XG5cbiAgICAgICAgICBpZiAodGhpcy5pc1NjaGVkdWxlKGpvYi5pbnRlcnZhbCkpIHtcbiAgICAgICAgICAgIGRlYnVnKCdqb2IuaW50ZXJ2YWwgaXMgc2NoZWR1bGUnLCBqb2IpO1xuICAgICAgICAgICAgdGhpcy5pbnRlcnZhbHNbbmFtZV0gPSBsYXRlci5zZXRJbnRlcnZhbChcbiAgICAgICAgICAgICAgKCkgPT4gdGhpcy5ydW4obmFtZSksXG4gICAgICAgICAgICAgIGpvYi5pbnRlcnZhbFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKE51bWJlci5pc0Zpbml0ZShqb2IuaW50ZXJ2YWwpICYmIGpvYi5pbnRlcnZhbCA+IDApIHtcbiAgICAgICAgICAgIGRlYnVnKCdqb2IuaW50ZXJ2YWwgaXMgZmluaXRlJywgam9iLmludGVydmFsKTtcbiAgICAgICAgICAgIHRoaXMuaW50ZXJ2YWxzW25hbWVdID0gc2V0SW50ZXJ2YWwoXG4gICAgICAgICAgICAgICgpID0+IHRoaXMucnVuKG5hbWUpLFxuICAgICAgICAgICAgICBqb2IuaW50ZXJ2YWxcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgZGVsZXRlIHRoaXMudGltZW91dHNbbmFtZV07XG4gICAgICAgIH0sIGpvYi50aW1lb3V0KTtcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5pc1NjaGVkdWxlKGpvYi5pbnRlcnZhbCkpIHtcbiAgICAgICAgZGVidWcoJ2pvYi5pbnRlcnZhbCBpcyBzY2hlZHVsZScsIGpvYik7XG4gICAgICAgIHRoaXMuaW50ZXJ2YWxzW25hbWVdID0gbGF0ZXIuc2V0SW50ZXJ2YWwoXG4gICAgICAgICAgKCkgPT4gdGhpcy5ydW4obmFtZSksXG4gICAgICAgICAgam9iLmludGVydmFsXG4gICAgICAgICk7XG4gICAgICB9IGVsc2UgaWYgKE51bWJlci5pc0Zpbml0ZShqb2IuaW50ZXJ2YWwpICYmIGpvYi5pbnRlcnZhbCA+IDApIHtcbiAgICAgICAgZGVidWcoJ2pvYi5pbnRlcnZhbCBpcyBmaW5pdGUnLCBqb2IpO1xuICAgICAgICB0aGlzLmludGVydmFsc1tuYW1lXSA9IHNldEludGVydmFsKCgpID0+IHRoaXMucnVuKG5hbWUpLCBqb2IuaW50ZXJ2YWwpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgZm9yIChjb25zdCBqb2Igb2YgdGhpcy5jb25maWcuam9icykge1xuICAgICAgdGhpcy5zdGFydChqb2IubmFtZSk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgc3RvcChuYW1lKSB7XG4gICAgaWYgKG5hbWUpIHtcbiAgICAgIGlmICh0aGlzLnRpbWVvdXRzW25hbWVdKSB7XG4gICAgICAgIGlmIChcbiAgICAgICAgICB0eXBlb2YgdGhpcy50aW1lb3V0c1tuYW1lXSA9PT0gJ29iamVjdCcgJiZcbiAgICAgICAgICB0eXBlb2YgdGhpcy50aW1lb3V0c1tuYW1lXS5jbGVhciA9PT0gJ2Z1bmN0aW9uJ1xuICAgICAgICApIHtcbiAgICAgICAgICB0aGlzLnRpbWVvdXRzW25hbWVdLmNsZWFyKCk7XG4gICAgICAgIH1cblxuICAgICAgICBkZWxldGUgdGhpcy50aW1lb3V0c1tuYW1lXTtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMuaW50ZXJ2YWxzW25hbWVdKSB7XG4gICAgICAgIGlmIChcbiAgICAgICAgICB0eXBlb2YgdGhpcy5pbnRlcnZhbHNbbmFtZV0gPT09ICdvYmplY3QnICYmXG4gICAgICAgICAgdHlwZW9mIHRoaXMuaW50ZXJ2YWxzW25hbWVdLmNsZWFyID09PSAnZnVuY3Rpb24nXG4gICAgICAgICkge1xuICAgICAgICAgIHRoaXMuaW50ZXJ2YWxzW25hbWVdLmNsZWFyKCk7XG4gICAgICAgIH1cblxuICAgICAgICBkZWxldGUgdGhpcy5pbnRlcnZhbHNbbmFtZV07XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLndvcmtlcnNbbmFtZV0pIHtcbiAgICAgICAgdGhpcy53b3JrZXJzW25hbWVdLm9uY2UoJ21lc3NhZ2UnLCAobWVzc2FnZSkgPT4ge1xuICAgICAgICAgIGlmIChtZXNzYWdlID09PSAnY2FuY2VsbGVkJykge1xuICAgICAgICAgICAgdGhpcy5jb25maWcubG9nZ2VyLmluZm8oXG4gICAgICAgICAgICAgIGBHcmFjZWZ1bGx5IGNhbmNlbGxlZCB3b3JrZXIgZm9yIGpvYiBcIiR7bmFtZX1cImAsXG4gICAgICAgICAgICAgIHRoaXMuZ2V0V29ya2VyTWV0YWRhdGEobmFtZSlcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICB0aGlzLndvcmtlcnNbbmFtZV0udGVybWluYXRlKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy53b3JrZXJzW25hbWVdLnBvc3RNZXNzYWdlKCdjYW5jZWwnKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMuY2xvc2VXb3JrZXJBZnRlck1zW25hbWVdKSB7XG4gICAgICAgIGlmIChcbiAgICAgICAgICB0eXBlb2YgdGhpcy5jbG9zZVdvcmtlckFmdGVyTXNbbmFtZV0gPT09ICdvYmplY3QnICYmXG4gICAgICAgICAgdHlwZW9mIHRoaXMuY2xvc2VXb3JrZXJBZnRlck1zW25hbWVdLmNsZWFyID09PSAnZnVuY3Rpb24nXG4gICAgICAgICkge1xuICAgICAgICAgIHRoaXMuY2xvc2VXb3JrZXJBZnRlck1zW25hbWVdLmNsZWFyKCk7XG4gICAgICAgIH1cblxuICAgICAgICBkZWxldGUgdGhpcy5jbG9zZVdvcmtlckFmdGVyTXNbbmFtZV07XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBwV2FpdEZvcigoKSA9PiB0aGlzLndvcmtlcnNbbmFtZV0gPT09IHVuZGVmaW5lZCk7XG4gICAgfVxuXG4gICAgZm9yIChjb25zdCBqb2Igb2YgdGhpcy5jb25maWcuam9icykge1xuICAgICAgdGhpcy5zdG9wKGpvYi5uYW1lKTtcbiAgICB9XG5cbiAgICByZXR1cm4gcFdhaXRGb3IoKCkgPT4gT2JqZWN0LmtleXModGhpcy53b3JrZXJzKS5sZW5ndGggPT09IDApO1xuICB9XG5cbiAgYWRkKGpvYnMpIHtcbiAgICAvL1xuICAgIC8vIG1ha2Ugc3VyZSBqb2JzIGlzIGFuIGFycmF5XG4gICAgLy9cbiAgICBpZiAoIUFycmF5LmlzQXJyYXkoam9icykpIHtcbiAgICAgIGpvYnMgPSBbam9ic107XG4gICAgfVxuXG4gICAgY29uc3QgZXJyb3JzID0gW107XG4gICAgY29uc3QgYWRkZWRKb2JzID0gW107XG5cbiAgICBmb3IgKGNvbnN0IFtpLCBqb2JfXSBvZiBqb2JzLmVudHJpZXMoKSkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgbmFtZXMgPSBbXG4gICAgICAgICAgLi4uZ2V0Sm9iTmFtZXMoam9icywgaSksXG4gICAgICAgICAgLi4uZ2V0Sm9iTmFtZXModGhpcy5jb25maWcuam9icylcbiAgICAgICAgXTtcblxuICAgICAgICB2YWxpZGF0ZUpvYihqb2JfLCBpLCBuYW1lcywgdGhpcy5jb25maWcpO1xuICAgICAgICBjb25zdCBqb2IgPSBidWlsZEpvYihqb2JfLCB0aGlzLmNvbmZpZyk7XG5cbiAgICAgICAgYWRkZWRKb2JzLnB1c2goam9iKTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBlcnJvcnMucHVzaChlcnIpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGRlYnVnKCdqb2JzIGFkZGVkJywgdGhpcy5jb25maWcuam9icyk7XG5cbiAgICAvLyBJZiB0aGVyZSB3ZXJlIGFueSBlcnJvcnMgdGhlbiB0aHJvdyB0aGVtXG4gICAgaWYgKGVycm9ycy5sZW5ndGggPiAwKSB7XG4gICAgICB0aHJvdyBjb21iaW5lRXJyb3JzKGVycm9ycyk7XG4gICAgfVxuXG4gICAgdGhpcy5jb25maWcuam9icy5wdXNoKC4uLmFkZGVkSm9icyk7XG4gICAgcmV0dXJuIGFkZGVkSm9icztcbiAgfVxuXG4gIGFzeW5jIHJlbW92ZShuYW1lKSB7XG4gICAgY29uc3Qgam9iID0gdGhpcy5jb25maWcuam9icy5maW5kKChqKSA9PiBqLm5hbWUgPT09IG5hbWUpO1xuICAgIGlmICgham9iKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEpvYiBcIiR7bmFtZX1cIiBkb2VzIG5vdCBleGlzdGApO1xuICAgIH1cblxuICAgIC8vIG1ha2Ugc3VyZSBpdCBhbHNvIGNsb3NlcyBhbnkgb3BlbiB3b3JrZXJzXG4gICAgYXdhaXQgdGhpcy5zdG9wKG5hbWUpO1xuXG4gICAgdGhpcy5jb25maWcuam9icyA9IHRoaXMuY29uZmlnLmpvYnMuZmlsdGVyKChqKSA9PiBqLm5hbWUgIT09IG5hbWUpO1xuICB9XG59XG5cbi8vIEV4cG9zZSBidGhyZWFkcyAodXNlZnVsIGZvciB0ZXN0cylcbi8vIGh0dHBzOi8vZ2l0aHViLmNvbS9jaGpqL2J0aHJlYWRzI2FwaVxuQnJlZS50aHJlYWRzID0ge1xuICBiYWNrZW5kOiB0aHJlYWRzLmJhY2tlbmQsXG4gIGJyb3dzZXI6IHRocmVhZHMuYnJvd3NlcixcbiAgbG9jYXRpb246IHRocmVhZHMubG9jYXRpb24sXG4gIGZpbGVuYW1lOiB0aHJlYWRzLmZpbGVuYW1lLFxuICBkaXJuYW1lOiB0aHJlYWRzLmRpcm5hbWUsXG4gIHJlcXVpcmU6IHRocmVhZHMucmVxdWlyZSxcbiAgcmVzb2x2ZTogdGhyZWFkcy5yZXNvbHZlLFxuICBleGl0OiB0aHJlYWRzLmV4aXQsXG4gIGNvcmVzOiB0aHJlYWRzLmNvcmVzXG59O1xuXG4vLyBwbHVnaW5zIGluc3BpcmVkIGJ5IERheWpzXG5CcmVlLmV4dGVuZCA9IChwbHVnaW4sIG9wdGlvbnMpID0+IHtcbiAgaWYgKCFwbHVnaW4uJGkpIHtcbiAgICAvLyBpbnN0YWxsIHBsdWdpbiBvbmx5IG9uY2VcbiAgICBwbHVnaW4ob3B0aW9ucywgQnJlZSk7XG4gICAgcGx1Z2luLiRpID0gdHJ1ZTtcbiAgfVxuXG4gIHJldHVybiBCcmVlO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBCcmVlO1xuIl19